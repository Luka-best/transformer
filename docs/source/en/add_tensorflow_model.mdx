<!--Copyright 2022 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
-->

# How to convert a ü§ó Transformers model to TensorFlow?

Having multiple frameworks available to use with ü§ó Transformers means you can play their strengths when designing your
application, but it also requires that compatibility must be added on a per-model basis. The good news is that adding
TensorFlow compatibility to an existing model is simpler than to [add a new model from scratch](add_new_model)!
Whether you wish to have a deeper understanding of large TensorFlow models, make a major open-source contribution, or
enable TensorFlow for your model of choice, this guide is for you.

This guide empowers you, a member of our community, to contribute with TensorFlow model weights and/or
architectures to be used in ü§ó Transformers, with minimal supervision from the Hugging Face team. Writing a new model
is no small feat, but opefully this guide will make it a walk in the park. Harnessing our collective
experiences is absolutely critical to do so, and thus we highly encourage that you suggest improvements to this guide.

Before you dive deeper into this guide, it is recommended that you check the following resources if you're new in
ü§ó Transformers:
- [General overview of ü§ó Transformers](https://huggingface.co/docs/transformers/add_new_model#general-overview-of-transformers)
- [Hugging Face's TensorFlow Philosophy](https://huggingface.co/blog/tensorflow-philosophy)

As for the remainder of this guide, you will learn what's needed to add a new TensorFlow model architecture, how to
efficiently debug mismatches across ML frameworks, as well as the procedure to convert PyTorch into TensorFlow model
weights.

## Step-by-step guide to add TensorFlow model architecture code

There are many ways to design a large model architecture, and multiple ways of implementing the same design. However,
you might recall from our [general overview of ü§ó Transformers](https://huggingface.co/docs/transformers/add_new_model#general-overview-of-transformers)
that we are an opinionated bunch - the ease of use of ü§ó Transformers relies on consistent design choices. From
experience, we can tell you a few important things about adding TensorFlow models:

- Don't reinvent the wheel! More often that not, there are at least two reference implementations you should check: the
PyTorch equivalent of the model you are implementing and other TensorFlow models for the same class of problems.
- Great model implementations survive the test of time. This doesn't happen because the code is perfect, but rather
because the code is easy to debug and build upon. If you make the life of the maintainers easy with your
implementation, by replicating the same patterns as in other TensorFlow models and minimizing the mismatch to the
PyTorch implementation, you ensure your contribution will be long lived.
- Ask for help when you're stuck! The ü§ó Transformers is here to help, and we've probably found solutions to the same
problem you're facing.

Here's an overview of the steps needed to add a TensorFlow model architecture

-  1. ‚òê Select the model you wish to convert
-  2. ‚òê Prepare transformers dev environment
-  3. ‚òê (Optional) Understand theoretical aspects and the existing implementation
-  4. ‚òê Implement the model architecture
-  5. ‚òê Implement model tests
-  6. ‚òê Run end-to-end integration tests
-  7. ‚òê Submitted the pull request
-  8. ‚òê (Optional) Added a demo notebook

### 1.-3. Prepare your model contribution

**1. Select the model you wish to convert**

Let's start off with the basics: the first thing you need to know is the architecture you want to convert. If you
haven't your eyes set on a specific architecture, asking the ü§ó Transformers for suggestions is a great way to maximize
the impact - we will guide you towards the most prominent architectures that are missing on the TensorFlow side. If
the specific model you want to use with TensorFlow already has a TensorFlow architecture implementation in
ü§ó Transformers but is lacking weights, feel free to jump straight into the last section of this page.

For simplicity, the remainder of this guide assumes you've decided to contribute with the TensorFlow version of
*BrandNewBert* (the same example as in the [guide](add_new_model) to add a new model from scratch).

<Tip>

Before starting the work on a TensorFlow model architecture, double-check that there is no ongoing effort to do so.
You can search for `TensorFlow BrandNewBert` on the [pull request GitHub page](https://github.com/huggingface/transformers/pulls).

</Tip>


**2. Prepare transformers dev environment**

Having selected the model architecture, open an draft PR to signal your intention to work on it. Follow the
instructions below to set up your environment and open a draft PR.

1. Fork the [repository](https://github.com/huggingface/transformers) by clicking on the ‚ÄòFork' button on the
   repository's page. This creates a copy of the code under your GitHub user account.

2. Clone your `transformers` fork to your local disk, and add the base repository as a remote:

```bash
git clone https://github.com/[your Github handle]/transformers.git
cd transformers
git remote add upstream https://github.com/huggingface/transformers.git
```

3. Set up a development environment, for instance by running the following command:

```bash
python -m venv .env
source .env/bin/activate
pip install -e ".[dev]"
```

**Note:** You don't need to have CUDA installed. Making the new model work on CPU is sufficient.

4. Create a branch with a descriptive name from your main branch

```bash
git checkout -b add_tf_brand_new_bert
```

5. Fetch and rebase to current main

```bash
git fetch upstream
git rebase upstream/main
```

6. Add an empty `.py` file in `transformers/src/models/brandnewbert/` named `modeling_tf_brandnewbert.py`. This will
be your TensorFlow model file.

7. Push the changes to your account using:

```bash
git add .
git commit -m "initial commit"
git push -u origin add_tf_brand_new_bert
```

8. Once you are satisfied, go to the webpage of your fork on GitHub. Click on ‚ÄúPull request‚Äù. Make sure to add the
   GitHub handle of some members of the Hugging Face team as reviewers, so that the Hugging Face team gets notified for
   future changes.

9. Change the PR into a draft by clicking on ‚ÄúConvert to draft‚Äù on the right of the GitHub pull request web page.


Now you have set up a development environment to port *BrandNewBert* to TensorFlow in ü§ó Transformers.



**3. ‚òê (Optional) Understand theoretical aspects and the existing implementation**

You should take some time to read *BrandNewBert's* paper, if such descriptive work exists. There might be large
sections of the paper that are difficult to understand. If this is the case, this is fine - don't worry! The goal is
not to get a deep theoretical understanding of the paper, but to extract the necessary information required to
effectively re-implement the model in ü§ó Transformers using TensorFlow. That being said, you don't have to spend too
much time on the theoretical aspects, but rather focus on the practical ones, namely the existing model documentation
page (e.g. [model docs for BERT](model_doc/bert)).

After you've grasped the basics of the models you are about to implement, it's important to understand the existing
implementation. This is a great chance to confirm that a working implementation matches your expectations for the
model, as well as to foresee technical challenges on the TensorFlow side.

It's perfectly natural that you feel overwhelmed with the amount of information that you've just absorved. It is
definitely not a requirement that you understand all facets of the model at this stage. Nevertheless, we highly
encourage you to clear any pressing questions in our [forum](https://discuss.huggingface.co/).


### 4. Model implementation



### 5. Add model tests



### 6.-8. Ensure everyone can use your model



## Debugging mismatches across ML frameworks




## Adding TF weights to ü§ó Hub
