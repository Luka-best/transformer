# Llama2

## ูุธุฑุฉ ุนุงูุฉ
ุงูุชุฑุญ ูููุฐุฌ Llama2 ูู [LLaMA: Open Foundation and Fine-Tuned Chat Models](https://ai.meta.com/research/publications/llama-2-open-foundation-and-fine-tuned-chat-models/) ุจูุงุณุทุฉ Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, Dan Bikelุ Lukas Blecher, Cristian Canton Ferrer, Moya Chen, Guillem Cucurull, David Esiobu, Jude Fernandes, Jeremy Fu, Wenyin Fu, Brian Fuller, Cynthia Gao, Vedanuj Goswami, Naman Goyal, Anthony Hartshorn, Saghar Hosseini, Rui Hou, Hakan Inan, Marcin Kardas, Viktor Kerkez Madian Khabsa, Isabel Kloumann, Artem Korenev, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Jenya Lee, Diana Liskovich, Yinghai Lu, Yuning Mao, Xavier Martinet, Todor Mihaylov, Pushka rMishra, Igor Molybog, Yixin Nie, Andrew Poulton, Jeremy Reizenstein, Rashi Rungta, Kalyan Saladi, Alan Schelten, Ruan Silva, Eric Michael Smith, Ranjan Subramanian, Xiaoqing EllenTan, Binh Tang, Ross Taylor, Adina Williams, Jian Xiang Kuan, Puxin Xu, Zheng Yan, Iliyan Zarov, Yuchen Zhang, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Sergey Edunov, Thomas Scialom. ููู ูุฌููุนุฉ ูู ููุงุฐุฌ ุงููุบุฉ ุงูุฃุณุงุณูุฉ ุงูุชู ุชุชุฑุงูุญ ูู 7 ุจูููู ุฅูู 70 ุจูููู ูุนููุฉุ ูุน ููุงุท ุชูุชูุด ุชูุช ูุนุงูุฑุชูุง ูุชุทุจูู ุงูุฏุฑุฏุดุฉ!

ุงูููุฎุต ูู ุงููุฑูุฉ ูู ูุง ููู:

> ูู ูุฐุง ุงูุนููุ ูููู ุจุชุทููุฑ ูุฅุตุฏุงุฑ Llama 2ุ ููู ูุฌููุนุฉ ูู ููุงุฐุฌ ุงููุบุฉ ุงููุจูุฑุฉ ุงููุณุจูุฉ ุงูุชุฏุฑูุจ ูุงููุนุงูุฑุฉ ุงูุชู ุชุชุฑุงูุญ ูู ุงููุทุงู ูู 7 ูููุงุฑุงุช ุฅูู 70 ูููุงุฑ ูุนููุฉ. ุชู ุชุญุณูู ููุงุฐุฌูุง ุงููุนุงูุฑุฉ ููุบุฉุ ูุงูุชู ูุทูู ุนูููุง ุงุณู Llama 2-Chatุ ูุงุณุชุฎุฏุงูุงุช ุงูุญูุงุฑ. ุชุชููู ููุงุฐุฌูุง ุนูู ููุงุฐุฌ ุงูุฏุฑุฏุดุฉ ููุชูุญุฉ ุงููุตุฏุฑ ูู ูุนุธู ุงููุนุงููุฑ ุงูุชู ุงุฎุชุจุฑูุงูุงุ ููุฏ ุชูููุ ุจูุงุกู ุนูู ุชููููุงุชูุง ุงูุจุดุฑูุฉ ูููุงุฆุฏุฉ ูุงูุณูุงูุฉุ ุจุฏููุงู ููุงุณุจุงู ูููุงุฐุฌ ุงููุตุฏุฑ ุงููุบูู. ููุฏู ูุตููุง ููุตูุงู ูููุฌูุง ูู ุงููุนุงูุฑุฉ ูุชุญุณููุงุช ุงูุณูุงูุฉ ููููุฐุฌ Llama 2-Chat ูู ุฃุฌู ุชูููู ุงููุฌุชูุน ูู ุงูุจูุงุก ุนูู ุนูููุง ูุงููุณุงููุฉ ูู ุงูุชุทููุฑ ุงููุณุคูู ูููุงุฐุฌ ุงููุบุฉ ุงููุจูุฑุฉ.

ุชุญูู ูู ุฌููุน ููุงุท ุชูุชูุด ูููุฐุฌ Llama2 [ููุง](https://huggingface.co/models?search=llama2).

ุชูุช ุงููุณุงููุฉ ุจูุฐุง ุงููููุฐุฌ ูู ูุจู [Arthur Zucker](https://huggingface.co/ArthurZ) ุจูุณุงููุงุช ูู [Lysandre Debut](https://huggingface.co/lysandre). ูุนุชูุฏ ููุฏ ุงูุชูููุฐ ูู Hugging Face ุนูู GPT-NeoX [ููุง](https://github.com/EleutherAI/gpt-neox). ูููู ุงูุนุซูุฑ ุนูู ุงูููุฏ ุงูุฃุตูู ูููุคูููู [ููุง](https://github.com/facebookresearch/llama).

## ูุตุงุฆุญ ุงูุงุณุชุฎุฏุงู

<Tip warning={true}>

ุชู ุชุฏุฑูุจ ููุงุฐุฌ "Llama2" ุจุงุณุชุฎุฏุงู "bfloat16"ุ ูููู ุงูุงุณุชุฏูุงู ุงูุฃุตูู ูุณุชุฎุฏู "float16". ุชุณุชุฎุฏู ููุงุท ุงูุชูุชูุด ุงูุชู ุชู ุชุญููููุง ุนูู ุงููุญุงูุฑ `torch_dtype = 'float16'`ุ ูุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุง ุจูุงุณุทุฉ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช `AutoModel` ูุชุญููู ููุงุท ุงูุชูุชูุด ูู `torch.float32` ุฅูู `torch.float16`.

`dtype` ููุฃูุฒุงู ุนุจุฑ ุงูุฅูุชุฑูุช ุบูุฑ ุฐู ุตูุฉ ูู ุงูุบุงูุจ ูุง ูู ุชูู ุชุณุชุฎุฏู `torch_dtype="auto"` ุนูุฏ ุชููุฆุฉ ูููุฐุฌ ุจุงุณุชุฎุฏุงู `model = AutoModelForCausalLM.from_pretrained("path"ุ torch_dtype = "auto")`. ูุงูุณุจุจ ูู ุฃู ุงููููุฐุฌ ุณูุชู ุชูุฒููู ุฃููุงู (ุจุงุณุชุฎุฏุงู `dtype` ูููุงุท ุงูุชูุชูุด ุนุจุฑ ุงูุฅูุชุฑูุช)ุ ุซู ุณูุชู ุชุญูููู ุฅูู `dtype` ุงูุงูุชุฑุงุถู ูู `torch` (ูุตุจุญ `torch.float32`)ุ ูุฃุฎูุฑุงูุ ุฅุฐุง ูุงู ููุงู `torch_dtype` ููุฏู ูู ุงูุชููููุ ูุณูุชู ุงุณุชุฎุฏุงูู.

ูุง ููุตู ุจุงูุชุฏุฑูุจ ุนูู ุงููููุฐุฌ ูู `float16` ููู ูุนุฑูู ุจุฅูุชุงุฌ `nan`ุ ูุฐููุ ูุฌุจ ุชุฏุฑูุจ ุงููููุฐุฌ ูู `bfloat16`.

</Tip>

ูุตุงุฆุญ:

- ูููู ุงูุญุตูู ุนูู ุงูุฃูุฒุงู ูููุงุฐุฌ Llama2 ุนู ุทุฑูู ููุก [ูุฐุง ุงููููุฐุฌ](https://ai.meta.com/resources/models-and-libraries/llama-downloads/)
- ุงูููุฏุณุฉ ุงููุนูุงุฑูุฉ ูุดุงุจูุฉ ุฌุฏูุง ูู Llama ุงูุฃููุ ูุน ุฅุถุงูุฉ Grouped Query Attention (GQA) ุจุนุฏ ูุฐู [ุงููุฑูุฉ](https://arxiv.org/pdf/2305.13245.pdf)
- ูุคุฏู ุชุนููู `config.pretraining_tp` ุฅูู ูููุฉ ูุฎุชููุฉ ุนู 1 ุฅูู ุชูุดูุท ุงูุญุณุงุจ ุงูุฃูุซุฑ ุฏูุฉ ูููู ุงูุฃุจุทุฃ ููุทุจูุงุช ุงูุฎุทูุฉุ ูุงูุชู ูุฌุจ ุฃู ุชุชุทุงุจู ุจุดูู ุฃูุถู ูุน ุงูููุบุงุฑูุชูุงุช ุงูุฃุตููุฉ.
- ูุณุชุฎุฏู ุงููููุฐุฌ ุงูุฃุตูู `pad_id = -1` ููุง ูุนูู ุฃูู ูุง ููุฌุฏ ุฑูุฒ ุฎุงุต ููุชุนุจุฆุฉ. ูุง ูููููุง ุฃู ูููู ูุฏููุง ููุณ ุงูููุทูุ ุชุฃูุฏ ูู ุฅุถุงูุฉ ุฑูุฒ ุฎุงุต ููุชุนุจุฆุฉ ุจุงุณุชุฎุฏุงู `tokenizer.add_special_tokens({"pad_token": "<pad>"})` ููู ุจุชุบููุฑ ุญุฌู ุชุถููู ุงูุฑูุฒ ููููุง ูุฐูู. ูุฌุจ ุนููู ุฃูุถูุง ุชุนููู `model.config.pad_token_id`. ูุชู ุชููุฆุฉ ุทุจูุฉ `embed_tokens` ูููููุฐุฌ ุจุงุณุชุฎุฏุงู `self.embed_tokens = nn.Embedding(config.vocab_sizeุ config.hidden_sizeุ self.config.padding_idx)`ุ ูุงูุฐู ูุชุฃูุฏ ูู ุฃู ุชุฑููุฒ ุงูุฑูุฒ ุงูุฎุงุต ุจุงูุชุนุจุฆุฉ ุณูุฎุฑุฌ ุฃุตูุงุฑูุงุ ูุฐุง ููุตู ุจุชูุฑูุฑู ุนูุฏ ุงูุชููุฆุฉ.
- ุจุนุฏ ููุก ุงููููุฐุฌ ูุงูุญุตูู ุนูู ุญู ุงููุตูู ุฅูู ููุงุท ุชูุชูุด ุงููููุฐุฌุ ูุฌุจ ุฃู ุชุชููู ูู ุงุณุชุฎุฏุงู ููุงุท ุงูุชูุชูุด ุงููุญููุฉ ุจุงููุนู. ูุฅูุงุ ุฅุฐุง ููุช ุชููู ุจุชุญููู ูููุฐุฌู ุงูุฎุงุตุ ููุง ุชุชุฑุฏุฏ ูู ุงุณุชุฎุฏุงู [ุณูุฑูุจุช ุงูุชุญููู](https://github.com/huggingface/transformers/blob/main/src/transformers/models/llama/convert_llama_weights_to_hf.py). ูููู ุงุณุชุฏุนุงุก ุงูุจุฑูุงูุฌ ุงููุตู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ ุงูุชุงูู (ููุซุงู):

```bash
python src/transformers/models/llama/convert_llama_weights_to_hf.py \
--input_dir /path/to/downloaded/llama/weights --model_size 7B --output_dir /output/path
```

- ุจุนุฏ ุงูุชุญูููุ ูููู ุชุญููู ุงููููุฐุฌ ูุงููุญูู ุงููุบูู ุนุจุฑ:

```python
from transformers import LlamaForCausalLM, LlamaTokenizer

tokenizer = LlamaTokenizer.from_pretrained("/output/path")
model = LlamaForCausalLM.from_pretrained("/output/path")
```

ููุงุญุธุฉ: ูุชุทูุจ ุชูููุฐ ุงูุจุฑูุงูุฌ ุงููุตู ูุณุงุญุฉ ูุงููุฉ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู (RAM) ูุงุณุชุถุงูุฉ ุงููููุฐุฌ ุจุงููุงูู ูู ุฏูุฉ float16 (ุญุชู ุฅุฐุง ูุงูุช ุฃูุจุฑ ุงูุฅุตุฏุงุฑุงุช ุชุฃุชู ูู ุนุฏุฉ ููุงุท ุชูุชูุดุ ูุญุชูู ูู ูููุง ุนูู ุฌุฒุก ูู ูู ูุฒู ูููููุฐุฌุ ูุฐุง ูุญุชุงุฌ ุฅูู ุชุญููููุง ุฌููุนูุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู). ุจุงููุณุจุฉ ูููููุฐุฌ 75Bุ ููุงู ุญุงุฌุฉ ุฅูู 145 ุฌูุฌุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู.

- LLaMA tokenizer ุนุจุงุฑุฉ ุนู ูููุฐุฌ BPE ูุนุชูุฏ ุนูู [sentencepiece](https://github.com/google/sentencepiece). ุฅุญุฏู ุบุฑุงุฆุจ sentencepiece ูู ุฃูู ุนูุฏ ูู ุชุดููุฑ ุชุณูุณูุ ุฅุฐุง ูุงู ุงูุฑูุฒ ุงูุฃูู ูู ุจุฏุงูุฉ ุงููููุฉ (ุนูู ุณุจูู ุงููุซุงู "Banana")ุ ูุฅู ุงููุญูู ุงููุบูู ูุง ูุณุจู ุงููุณุงูุฉ ุงูุจุงุฏุฆุฉ ุฅูู ุงูุณูุณูุฉ.
- ุนูุฏ ุงุณุชุฎุฏุงู Flash Attention 2 ุนุจุฑ `attn_implementation="flash_attention_2"`ุ ูุง ุชูุฑุฑ `torch_dtype` ุฅูู ุทุฑููุฉ `from_pretrained` ูุงุณุชุฎุฏู ุงูุชุฏุฑูุจ Mixed-Precision ุงูุชููุงุฆู. ุนูุฏ ุงุณุชุฎุฏุงู `Trainer`ุ ูููู ุงูุฃูุฑ ุจุจุณุงุทุฉ ุจุชุญุฏูุฏ ุฅูุง `fp16` ุฃู `bf16` ุฅูู `True`. ูุฅูุงุ ุชุฃูุฏ ูู ุงุณุชุฎุฏุงูู ูู `torch.autocast`. ูุฐุง ูุทููุจ ูุฃู Flash Attention ูุฏุนู ููุท ุฃููุงุน ุงูุจูุงูุงุช `fp16` ู`bf16`.

## ุงูููุงุฑุฏ

ูุงุฆูุฉ ุจููุงุฑุฏ Hugging Face ุงูุฑุณููุฉ ูููุงุฑุฏ ุงููุฌุชูุน (ูุดุงุฑ ุฅูููุง ุจู ๐) ููุณุงุนุฏุชู ูู ุงูุจุฏุก ุจุงุณุชุฎุฏุงู LLaMA2. ุฅุฐุง ููุช ููุชููุง ุจุชูุฏูู ููุฑุฏ ูุฅุฏุฑุงุฌู ููุงุ ูุงูุฑุฌุงุก ูุชุญ ุทูุจ ุณุญุจ ููุฑุงุฌุนุชู! ูุฌุจ ุฃู ููุธูุฑ ุงูููุฑุฏ ุจุดูู ูุซุงูู ุดูุฆูุง ุฌุฏูุฏูุง ุจุฏูุงู ูู ุชูุฑุงุฑ ููุฑุฏ ููุฌูุฏ.

- [Llama 2 is here - get it on Hugging Face](https://huggingface.co/blog/llama2)ุ ููุดูุฑ ูุฏููุฉ ุญูู Llama 2 ูููููุฉ ุงุณุชุฎุฏุงูู ูุน ๐ค Transformers ู๐ค PEFT.
- [LLaMA 2 - Every Resource you need](https://www.philschmid.de/llama-2)ุ ูุฌููุนุฉ ูู ุงูููุงุฑุฏ ุฐุงุช ุงูุตูุฉ ููุชุนุฑู ุนูู LLaMA 2 ูููููุฉ ุงูุจุฏุก ุจุณุฑุนุฉ.
<PipelineTag pipeline="text-generation"/>
- [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/drive/1PEQyJO1-f6j0S_XJ8DV50NkpzasXkrzd?usp=sharing) ุญูู ููููุฉ ูุนุงูุฑุฉ Llama 2 ูู Google Colab ุจุงุณุชุฎุฏุงู QLoRA ูุฏูุฉ 4 ุจุช. ๐
- [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/drive/134o_cXcMe_lsvl15ZE_4Y75Kstepsntu?usp=sharing) ุญูู ููููุฉ ูุนุงูุฑุฉ ูููุฐุฌ "Llama-v2-7b-guanaco" ุจุงุณุชุฎุฏุงู QLoRA ุจุฏูุฉ 4 ุจุช ูุชูููุฏ ูุฌููุนุงุช ุจูุงูุงุช ุงูุฃุณุฆูุฉ ูุงูุฃุฌูุจุฉ ูู ูููุงุช PDF. ๐
<PipelineTag pipeline="text-classification"/>
- [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/drive/1ggaa2oRFphdBmqIjSEbnb_HGkcIRC2ZB?usp=sharing) ุญูู ููููุฉ ูุนุงูุฑุฉ ูููุฐุฌ Llama 2 ุจุงุณุชุฎุฏุงู QLoRa ูTRL ููุฌููุนุฉ ุจูุงูุงุช ุงูุชุตููู ุงููุตู ุงูููุฑูุฉ. ๐๐ฐ๐ท
โ๏ธ Optimization
- [Fine-tune Llama 2 with DPO](https://huggingface.co/blog/dpo-trl)ุ ุฏููู ูุงุณุชุฎุฏุงู ุทุฑููุฉ DPO ูููุชุจุฉ TRL ููุนุงูุฑุฉ Llama 2 ุนูู ูุฌููุนุฉ ุจูุงูุงุช ูุญุฏุฏุฉ.
- [Extended Guide: Instruction-tune Llama 2](https://www.philschmid.de/instruction-tune-llama-2)ุ ุฏููู ูุชุฏุฑูุจ Llama 2 ูุชูููุฏ ุงูุชุนูููุงุช ูู ุงููุฏุฎูุงุชุ ูุชุญููู ุงููููุฐุฌ ูู ุงุชุจุงุน ุงูุชุนูููุงุช ุฅูู ุฅุนุทุงุก ุงูุชุนูููุงุช.
- [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/drive/1SYpgFpcmtIUzdE7pxqknrM4ArCASfkFQ?usp=sharing) ุญูู ููููุฉ ูุนุงูุฑุฉ ูููุฐุฌ Llama 2 ุนูู ุฌูุงุฒ ููุจููุชุฑ ุดุฎุตู ุจุงุณุชุฎุฏุงู QLoRa ูTRL. ๐
โก๏ธ Inference
- [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/drive/1TC56ArKerXUpbgRy5vM3woRsbTEVNq7h?usp=sharing) ุญูู ููููุฉ ุชุญุฏูุฏ ูููุฉ ูููุฐุฌ Llama 2 ุจุงุณุชุฎุฏุงู GPTQ ูู ููุชุจุฉ AutoGPTQ. ๐
- [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/drive/1X1z9Q6domMKl2CnEM0QGHNwidLfR4dW2?usp=sharing) ุญูู ููููุฉ ุชุดุบูู ูููุฐุฌ Llama 2 Chat Model ุจุฏูุฉ 4 ุจุช ุนูู ุฌูุงุฒ ููุจููุชุฑ ูุญูู ุฃู Google Colab. ๐
๐ Deploy
- [Fine-tune LLaMA 2 (7-70B) on Amazon SageMaker](https://www.philschmid.de/sagemaker-llama2-qlora)ุ ุฏููู ูุงูู ูู ุงูุฅุนุฏุงุฏ ุฅูู ูุนุงูุฑุฉ QLoRA ูุงููุดุฑ ุนูู Amazon SageMaker.
- [Deploy Llama 2 7B/13B/70B on Amazon SageMaker](https://www.philschmid.de/sagemaker-llama-llm)ุ ุฏููู ูุงุณุชุฎุฏุงู ุญุงููุฉ DLC LLM ูู Hugging Face ูููุดุฑ ุงูุขูู ูุงููุงุจู ููุชุทููุฑ.


## LlamaConfig

[[autodoc]] LlamaConfig
## LlamaTokenizer

[[autodoc]] LlamaTokenizer
- build_inputs_with_special_tokens
- get_special_tokens_mask
- create_token_type_ids_from_sequences
- save_vocabulary
## LlamaTokenizerFast

[[autodoc]] LlamaTokenizerFast
- build_inputs_with_special_tokens
- get_special_tokens_mask
- create_token_type_ids_from_sequences
- update_post_processor
- save_vocabulary
## LlamaModel

[[autodoc]] LlamaModel
- forward
## LlamaForCausalLM

[[autodoc]] LlamaForCausalLM
- forward
## LlamaForSequenceClassification

[[autodoc]] LlamaForSequenceClassification
- forward