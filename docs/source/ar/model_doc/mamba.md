# Mamba

## ูุธุฑุฉ ุนุงูุฉ
ุงูุชุฑุญ ูููุฐุฌ ูุงูุจุง ูู [ูุงูุจุง: ููุฐุฌุฉ ุชุณูุณู ุงูููุช ุงูุฎุทู ูุน ูุณุงุญุงุช ุงูุญุงูุฉ ุงูุงูุชูุงุฆูุฉ](https://arxiv.org/abs/2312.00752) ุจูุงุณุทุฉ ุฃูุจุฑุช ุฌู ูุชุฑู ุฏุงู.

ูุฐุง ุงููููุฐุฌ ูู ุจููุฉ ูููุฐุฌูุฉ ุฌุฏูุฏุฉ ุชุนุชูุฏ ุนูู ููุงุฐุฌ ูุณุงุญุงุช ุงูุญุงูุฉ. ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุญูู ุงูุญุฏุณ ูุฑุงุก ูุฐู [ููุง](https://srush.github.io/annotated-s4/).

ุงูููุฎุต ูู ุงููุฑูุฉ ูู ูุง ููู:

*ุชุนุชูุฏ ููุงุฐุฌ ุงูุฃุณุงุณุ ุงูุชู ุชุนูู ุงูุขู ุนูู ุชุดุบูู ูุนุธู ุงูุชุทุจููุงุช ุงููุซูุฑุฉ ูู ุงูุชุนูู ุงูุนูููุ ุจุดูู ุดุจู ุนุงููู ุนูู ุจููุฉ ุงููุญูู ููุญุฏุชู ุงูุฃุณุงุณูุฉ ููุญุฏุฉ ุงูุงูุชูุงู. ููุฏ ุชู ุชุทููุฑ ุงูุนุฏูุฏ ูู ุงูุชุตูููุงุช ุงููุนูุงุฑูุฉ ุฐุงุช ุงูููุช ุฏูู ุงูุชุฑุจูุนู ูุซู ุงูุงูุชูุงู ุงูุฎุทูุ ูุงูููุงุฐุฌ ุงููุชูุฑุฑุฉ ูุงููููุฏุฉุ ูููุงุฐุฌ ูุณุงุญุงุช ุงูุญุงูุฉ ุงูููุธูุฉุ ููุนุงูุฌุฉ ุนุฏู ููุงุกุฉ ุงููุญูู ุงูุญุณุงุจู ุนูู ุงูุชุณูุณูุงุช ุงูุทูููุฉุ ูููููุง ูู ุชุคุฏ ุฃุฏุงุกู ุฌูุฏูุง ูุซู ุงูุงูุชูุงู ุจุงูุทุฑุงุฆู ุงููููุฉ ูุซู ุงููุบุฉ. ูุญุฏุฏ ุฃู ุฃุญุฏ ุฃูุฌู ุงููุตูุฑ ุงูุฑุฆูุณูุฉ ููุฐู ุงูููุงุฐุฌ ูู ุนุฏู ูุฏุฑุชูุง ุนูู ุฅุฌุฑุงุก ุงูุงุณุชุฏูุงู ุงููุงุฆู ุนูู ุงููุญุชููุ ููููู ุจุนุฏุฉ ุชุญุณููุงุช. ุฃููุงูุ ูุคุฏู ุจุจุณุงุทุฉ ุงูุณูุงุญ ููุนููุงุช SSM ุจุฃู ุชููู ุฏุงูุงุช ููุฅุฏุฎุงู ุฅูู ูุนุงูุฌุฉ ุถุนููุง ูุน ุงูุทุฑุงุฆู ุงููููุตูุฉุ ููุง ูุณูุญ ูููููุฐุฌ ุจุงูุชูุงุฆูุฉ ุงูุชุดุงุฑ ุงููุนูููุงุช ุฃู ูุณูุงููุง ุนูู ุทูู ุจุนุฏ ุทูู ุงูุชุณูุณู ุงุนุชูุงุฏูุง ุนูู ุงูุฑูุฒ ุงูุญุงูู. ุซุงูููุงุ ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ุงูุชุบููุฑ ูููุน ุงุณุชุฎุฏุงู ุงูุชุญูููุงุช ุงููุนุงูุฉุ ุฅูุง ุฃููุง ูุตูู ุฎูุงุฑุฒููุฉ ูุชูุงุฒูุฉ ูุงุนูุฉ ุจุงูุฃุฌูุฒุฉ ูู ุงููุถุน ุงููุชูุฑุฑ. ูุฏูุฌ ูุฐู SSM ุงูุงูุชูุงุฆูุฉ ูู ุจููุฉ ุดุจูุฉ ุนุตุจูุฉ ูุจุณุทุฉ ูู ุงูููุงูุฉ ุฅูู ุงูููุงูุฉ ุจุฏูู ูุชู ุงูุชูุงู ุฃู ุญุชู ูุชู MLP (Mamba). ูุชูุชุน ูุงูุจุง ุจุงุณุชุฏูุงู ุณุฑูุน (5x ูู ุฎูุงู ูุถุน ุงููุญููุงุช) ูุชุฏุฑุฌ ุฎุทู ูู ุทูู ุงูุชุณูุณูุ ููุชุญุณู ุฃุฏุงุคู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ ุญุชู ุชุณูุณูุงุช ุงูููููู ุทูููุง. ุจุงุนุชุจุงุฑู ุงูุนููุฏ ุงูููุฑู ูููููุฐุฌ ุงูุชุณูุณูู ุงูุนุงูุ ูุญูู ูุงูุจุง ุฃุฏุงุกู ูุชููุฒูุง ุนุจุฑ ุทุฑุงุฆู ูุชุนุฏุฏุฉ ูุซู ุงููุบุฉ ูุงูุตูุช ูุนูู ุงูุฌูููู. ูู ููุฐุฌุฉ ุงููุบุฉุ ูุชููู ูููุฐุฌูุง ูุงูุจุง-3B ุนูู ุงููุญููุงุช ุจููุณ ุงูุญุฌู ููุชุทุงุจู ูุน ุงููุญููุงุช ุงูุชู ูุจูุบ ุญุฌููุง ุถุนู ุญุฌููุงุ ูู ูู ูู ุงูุชุฏุฑูุจ ุงููุณุจู ูุงูุชูููู ุงููุงุญู.*

ูุตุงุฆุญ:

- ูุงูุจุง ูู ุจููุฉ ูููุฐุฌ ูุณุงุญุฉ ุญุงูุฉ ุฌุฏูุฏุฉ ุชูุงูุณ ุงููุญููุงุช ุงูููุงุณูููุฉ. ููู ูุนุชูุฏ ุนูู ุฎุท ุงูุชูุฏู ูู ููุงุฐุฌ ูุณุงุญุงุช ุงูุญุงูุฉ ุงูููุธูุฉุ ูุน ุชุตููู ูุชูููุฐ ูุนุงููู ููุงุนููู ุจุงูุฃุฌูุฒุฉ ุนูู ุบุฑุงุฑ [FlashAttention](https://github.com/Dao-AILab/flash-attention).

- ุชููุฏุณ ูุงูุจุง ุทุจูุงุช "ุงููุฒุฌ"ุ ูุงูุชู ุชุนุงุฏู ุทุจูุงุช "ุงูุงูุชูุงู". ุงูููุทู ุงูุฃุณุงุณู ูู "ูุงูุจุง" ููุฌูุฏ ูู ูุฆุฉ "MambaMixer".

- ููุงู ุชูููุฐุงู ูุชุนุงูุดุงู: ุฃุญุฏููุง ููุญุณูู ููุณุชุฎุฏู ููู CUDA ุงูุณุฑูุนุฉุ ูู ุญูู ุฃู ุงูุขุฎุฑ ุจุณูุท ููููู ูููู ุชุดุบููู ุนูู ุฃู ุฌูุงุฒ!

- ูุณุชููุฏ ุงูุชูููุฐ ุงูุญุงูู ูู ููู CUDA ุงูุฃุตููุฉ: ูุง ูุนุงุฏู ุงูุงูุชูุงู ุงูููุฑู ูู ูุงูุจุง ูุณุชุถููู ["mamba-ssm"](https://github.com/state-spaces/mamba) ู ["causal_conv1d"](https://github.com/Dao-AILab/causal-conv1d) ุงููุณุชูุฏุนุงุช. ุชุฃูุฏ ูู ุชุซุจูุชูุง ุฅุฐุง ูุงู ุฌูุงุฒู ูุฏุนููุง!

- ุงููุณุงููุงุช ูุฌุนู ุงููุณุงุฑ ุงูุจุณูุท ุฃุณุฑุน ููุถุน ุชุฑุญูุจ ๐ค

ุชูุช ุงููุณุงููุฉ ุจูุฐุง ุงููููุฐุฌ ูู ูุจู [ArthurZ](https://huggingface.co/ArthurZ).

ูููู ุงูุนุซูุฑ ุนูู ุงูููุฏ ุงูุฃุตูู [ููุง](https://github.com/state-spaces/mamba).

# ุงูุงุณุชุฎุฏุงู

### ูุซุงู ุจุณูุท ุนูู ุงูุชูููุฏ:

```python
from transformers import MambaConfig, MambaForCausalLM, AutoTokenizer
import torch

tokenizer = AutoTokenizer.from_pretrained("state-spaces/mamba-130m-hf")
model = MambaForCausalLM.from_pretrained("state-spaces/mamba-130m-hf")
input_ids = tokenizer("Hey how are you doing?", return_tensors="pt")["input_ids"]

out = model.generate(input_ids, max_new_tokens=10)
print(tokenizer.batch_decode(out))
```

### Peft fine-tuning

ุงูุฅุตุฏุงุฑ ุงูุจุทูุก ุบูุฑ ูุณุชูุฑ ููุบุงูุฉ ููุชุฏุฑูุจุ ููุญุชุงุฌ ุงูุฅุตุฏุงุฑ ุงูุณุฑูุน ุฅูู `float32`!

```python
from datasets import load_dataset
from trl import SFTTrainer
from peft import LoraConfig
from transformers import AutoTokenizer, AutoModelForCausalLM, TrainingArguments
model_id = "state-spaces/mamba-130m-hf"
tokenizer = AutoTokenizer.from_pretrained(model_id)
model = AutoModelForCausalLM.from_pretrained(model_id)
dataset = load_dataset("Abirate/english_quotes", split="train")
training_args = TrainingArguments(
    output_dir="./results",
    num_train_epochs=3,
    per_device_train_batch_size=4,
    logging_dir='./logs',
    logging_steps=10,
    learning_rate=2e-3
)
lora_config = LoraConfig(
    r=8,
    target_modules=["x_proj", "embeddings", "in_proj", "out_proj"],
    task_type="CAUSAL_LM",
    bias="none"
)
trainer = SFTTrainer(
    model=model,
    tokenizer=tokenizer,
    args=training_args,
    peft_config=lora_config,
    train_dataset=dataset,
    dataset_text_field="quote",
)
trainer.train()
```

## MambaConfig

[[autodoc]] MambaConfig

## MambaModel

[[autodoc]] MambaModel

- forword

## MambaLMHeadModel

[[autodoc]] MambaForCausalLM

- forword